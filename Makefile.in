#
# Maketool - GTK-based front end for gmake
# Copyright (c) 1999 Greg Banks
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
# 
# $Id: Makefile.in,v 1.13 1999-10-17 08:53:26 gnb Exp $
#

prefix=		@prefix@
exec_prefix=	@exec_prefix@
BINDIR=		@bindir@
INSTALL=	@INSTALL@
PACKAGE=	@PACKAGE@
VERSION=	@VERSION@
@USRDOC@DOCDIR=		$(prefix)/doc/$(PACKAGE)-$(VERSION)
localedir=	$(prefix)/@DATADIRNAME@/locale

CC=		@CC@
CFLAGS=		@CFLAGS@
CPPFLAGS=	@GTK_CFLAGS@ -D_USE_BSD -I. -Iicons -Iintl \
		-DLOCALEDIR=\"$(localedir)\" \
		$(TESTCPPFLAGS)
LDLIBS=		@GTK_LIBS@ @INTLLIBS@
O=		objs

SOURCES=	main.c filter.c help.c preferences.c log.c ui.c \
		spawn.c util.c glib_extra.c
HEADERS=	maketool.h filter.h common.h log.h ui.h \
		spawn.h util.h glib_extra.h
OBJECTS=	$(SOURCES:%.c=$O/%.o)

top_srcdir=	.
top_builddir=	.
SUBDIRS=	icons intl po #test

###

# maketool program

all:: maketool

maketool: $(OBJECTS) _libintl
	$(LINK.c) -o $@ $(OBJECTS) $(LDLIBS)
	
install:: $(BINDIR)/maketool

$(BINDIR)/maketool: maketool
	test -d $(@D) || $(INSTALL) -m 755 -d $(@D)
	$(INSTALL) -m 755 $< $@
	
uninstall::
	$(RM) $(BINDIR)/maketool
	
clean::
	$(RM) maketool
		
###

# extract_targets shell script

install:: $(BINDIR)/extract_targets

$(BINDIR)/extract_targets: extract_targets
	test -d $(@D) || $(INSTALL) -m 755 -d $(@D)
	$(INSTALL) -m 755 $< $@
	
uninstall::
	$(RM) $(BINDIR)/extract_targets
	
###

# C infrastructure

$O/%.o: %.c $O/.stamp
	$(COMPILE.c) -o $@ $<
	
$O/.stamp:
	-mkdir -p $(@D)
	touch $@

clean::
	$(RM) -r $O
###

# Subdirectories

all install uninstall clean::
	for subdir in $(SUBDIRS); do \
	  $(MAKE) -C $$subdir $@ || exit 1; \
	done

_libintl:
	$(MAKE) -C intl all
		
###

argstest:
	-$(RM) maketool $O/main.o
	$(MAKE) TESTCPPFLAGS=-DARGSTEST=1 maketool
	awk -f argstest.awk < argstest.dat
	-$(RM) maketool $O/main.o
	
	
###

# licence.c contains the COPYING file in C syntax. This
# avoids having to install the COPYING file on platforms
# other than Linux.
$O/help.o: licence.c
licence.c: COPYING
	sed -e 's///g' -e 's/\\/\\\\/g' -e 's/"/\\"/g' -e 's/^\(.*\)$$/"\1\\n"/' <$< >$@

clean::
	$(RM) licence.c
	
###

# doco. Such as it is...
# Note that installing TODO etc into /usr/doc is a Linux
# tradition, suitable for the world of rapidly mutating
# Open Source software. It's not really appropriate for
# commercial Unices.

@USRDOC@install::
@USRDOC@	test -d $(DOCDIR) || $(INSTALL) -m 755 -d $(DOCDIR)
@USRDOC@	$(INSTALL) -m 755 COPYING $(DOCDIR)/COPYING
@USRDOC@	$(INSTALL) -m 755 COPYRIGHT $(DOCDIR)/COPYRIGHT
@USRDOC@	$(INSTALL) -m 755 TODO $(DOCDIR)/TODO
@USRDOC@	$(INSTALL) -m 755 CHANGES $(DOCDIR)/CHANGES
	
@USRDOC@uninstall::
@USRDOC@	$(RM) $(DOCDIR)/COPYING
@USRDOC@	$(RM) $(DOCDIR)/COPYRIGHT
@USRDOC@	$(RM) $(DOCDIR)/TODO
@USRDOC@	$(RM) $(DOCDIR)/CHANGES

###

# Making a distribution
distdir=	$(PACKAGE)-$(VERSION)
DISTTAR=	$(PACKAGE)-$(VERSION)-src.tgz
DISTFILES=	\
		ABOUT-NLS COPYING COPYRIGHT TODO CHANGES maketool.spec.in \
		\
		configure.in aclocal.m4 config.guess config.sub install-sh \
		configure Makefile.in config.h.in mkinstalldirs \
		\
		$(SOURCES) $(HEADERS) \
		extract_targets.sh


dist:
	$(RM) -r $(distdir)
	mkdir $(distdir)
	chmod 777 $(distdir)
	for file in $(DISTFILES); do \
	  ln $$file $(distdir) 2>/dev/null || cp -p $$file $(distdir) 2>/dev/null; \
	done
	for subdir in $(SUBDIRS); do \
	  mkdir $(distdir)/$$subdir || exit 1; \
	  chmod 777 $(distdir)/$$subdir; \
	  $(MAKE) -C $$subdir $@ || exit 1; \
	done
	tar chozf $(DISTTAR) $(distdir)
	$(RM) -r $(distdir)

rpm: dist
	test -d /usr/src/redhat/SOURCES || $(INSTALL) -m 755 -d /usr/src/redhat/SOURCES
	$(INSTALL) -m 644 $(DISTTAR) /usr/src/redhat/SOURCES/$(DISTTAR)
	rpm -ba --clean maketool.spec
		
##
# deps
	
objs/filter.o:\
filter.h common.h config.h
objs/glib_extra.o:\
common.h config.h glib_extra.h
objs/help.o:\
maketool.h common.h config.h spawn.h glib_extra.h ui.h util.h icons/maketool_l.xpm
objs/log.o:\
maketool.h common.h config.h filter.h log.h util.h icons/error.xpm icons/warning.xpm\
icons/info.xpm
objs/main.o:\
maketool.h common.h config.h spawn.h glib_extra.h ui.h log.h filter.h util.h icons/all.xpm\
icons/again.xpm icons/clean.xpm icons/clear.xpm icons/next.xpm icons/print.xpm icons/anim0.xpm\
icons/anim0a.xpm icons/anim1.xpm icons/anim1a.xpm icons/anim1b.xpm icons/anim2.xpm\
icons/anim2a.xpm icons/anim3.xpm icons/anim3a.xpm icons/anim3b.xpm icons/anim4.xpm\
icons/anim4a.xpm icons/anim5.xpm icons/anim6.xpm icons/anim7.xpm icons/anim8.xpm\
icons/maketool.xpm icons/stop.xpm
objs/preferences.o:\
ui.h common.h config.h maketool.h util.h
objs/spawn.o:\
spawn.h common.h config.h glib_extra.h
objs/ui.o:\
ui.h common.h config.h util.h
objs/util.o:\
util.h common.h config.h
